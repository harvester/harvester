# Harvester CRD Helm Chart

## Chart Details

This chart includes following CRDs:

- Harvester (Automatically generated by [this script](https://github.com/harvester/harvester/blob/master/scripts/generate-manifest))
- KubeVirt
- csi-snapshotter
- whereabouts

## Introduction

Harvester uses a `ManagedChart` resource to deploy the [Harvester CRDs](https://github.com/harvester/harvester/tree/master/deploy/charts/harvester-crd). This is configured via the [harvester-installer](https://github.com/harvester/harvester-installer/blob/master/pkg/config/templates/rancherd-10-harvester.yaml). Be aware that `deploy/harvester` and `deploy/harvester-crd` are two separate `ManagedChart` resources.

Harvester depends on several upstream projects to provide the CRDs and APIs it needs. To simplify the management of these resources, Harvester organized them in a separate chart, as recommended by the [Helm's documentation](https://helm.sh/docs/chart_best_practices/custom_resource_definitions/#method-2-separate-charts).

Harvester simplifies the upgrade of the CRDs by orchestrating their manifests in the [`upgrade_manifests.sh`](https://github.com/harvester/harvester/blob/50da36ac3b751c1a1dbfc8d25e5499a4c6216450/package/upgrade/upgrade_manifests.sh#L1358) script. This ensures that users are not burdened by the different CRD schema upgrade strategies of the dependency projects.
	
> [!Note]
> Longhorn CRDs are not managed here because Longhorn handles its own CRD creation process.

## For Developers

### How to bump CRDs

Bumping a CRD is quite straightforward. Developers just need to download the CRD from the correct source and place it in the `harvester-crds` folder.

For example, to bump the KubeVirt CRD to version v1.5.1, download it from:

`https://github.com/kubevirt/kubevirt/releases/download/v1.5.1/kubevirt-operator.yaml`

Search for `CustomResourceDefinition` in the file, copy the relevant CRD, and save it with a versioned filename like `crd-kubevirt-1.5.1.yaml`. Be sure to delete the old version.

> If you're interested in this change, please check [this issue](https://github.com/harvester/harvester/issues/8163) for more details.

### Special Case

However, not every CRDs can be managed under `harvester-crds` folder.

For example, the `cdi` CRDs are managed differently to accommodate the [built-in schema removal mechanism](https://github.com/kubevirt/containerized-data-importer/blob/e136558c999acce03291849aacc8154026e58445/pkg/operator/controller/callbacks.go#L61-L62) of the `cdi-operator`. For more information, see the discussion at [#7912 (comment)](https://github.com/harvester/harvester/issues/7912#issuecomment-2743944344).

If the CRD is similar to `cdi`, copy it to the `package/upgrade/extra_manifests` folder, and update the [`upgrade_manifests.sh`](https://github.com/harvester/harvester/blob/50da36ac3b751c1a1dbfc8d25e5499a4c6216450/package/upgrade/upgrade_manifests.sh#L1358) script like this:

```sh
for manifest in /usr/local/share/extra_manifests/{your_new_crds}/*.yaml; do
    echo "Applying $manifest"
    kubectl apply -f "$manifest"
done
```

In this case, there's no need to put it under the `harvester-crd` folder.

## License
Copyright (c) 2025 [SUSE, LLC.](https://www.suse.com/)

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

[http://www.apache.org/licenses/LICENSE-2.0](http://www.apache.org/licenses/LICENSE-2.0)

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
