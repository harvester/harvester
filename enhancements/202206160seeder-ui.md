# Title

Seeder Dashboard HEP


## Summary

Seeder is a project to provision Harvester environments for use. At present the only way to currently leverage its functionality is via a yaml, and a Dashboard/UI would improve the UX.

### Related Issues

[#2346](https://github.com/harvester/harvester/issues/2346)

## Motivation

With Seeder we are working to introduce a easy way to provision Harvester clusters using baremetal nodes. With the additional UI, we are looking to introduce a better UX.

### Goals

The Seeder UI will users to do the following:

* Leverage K8s fine grained rbac, to control baremetal nodes available to a particular user for provisioning a Harvester cluster
* Ability to identify inventory allocated to user
* Ability to get a quick overview of free inventory available for use in clusters

### Non-goals [optional]

Seeder UI will be a standalone project and currently there are no plans to integrate it into the Harvester UI.

## Proposal

The proposed flow of using Seeder via the Seeder UI will be as follows:

* `Inventory Definition`: Admin uses the Inventory page to define Inventory items in different backend namespaces. The admin will have complete ownership over the `inventory` objects.
* `AddressPool Definition`: Admin uses the AddressPool page to define multiple AddressPool objects across different namespaces. The admin will have complete ownership over the `addresspools` objects.
* `User Creation`: Users will be defined in the Seeder UI, and will be provided ability to list `inventory` and `addresspool` objects from specific namespaces only.
* `Cluster creation`: User can create a cluster by choosing unused inventory available and ready addresspools to define a cluster. This workflow will basically generate the `cluster` object which will be processed by the backend operators to provision the cluster.
* `Cluster Details`: Once a user has submitted a cluster, the user should be able to view the status on the cluster, and subsequently access fields from the cluster and inventory status to find details on how to access the cluster and underlying nodes.

### User Stories
Once the Seeder UI and Seeder are defined the admins should be able to define `Inventory` and `AddressPool` definitions. 

Users should not be able to consume these `Inventory` and `AddressPool` definitions to create `Clusters`.

#### Story 1
Admin user should be able to define Inventory by providing the following mandatory fields:

* `Name`: Name of the Inventory object.
* `Namespace`: Namespace in which this object should be created.
* `Primary Disk`: Name of disk which will be mapped to harvester install disk
* `MAC address`: Mac address for what will be the `harvester-mgmt` interface during the install process. This interface will also be used for PXE booting the device.
* `BMC Address`: This is the address for the BMC console of the Inventory
* `BMC Port`: This is the port for the BMC console, default value of 623 should be applied.
* `Username`: Username to access BMC console
* `Password`: Password to access BMC console

The `Username` and `Password` will be stored as a K8s Secret, and referred to in the Inventory object as `.spec.baseboardSpec.authRefSecret`

The UI will reconcile the status on the Inventory object, and accordingly reflect the same in the UI.

#### Story 2
Admin user should be able to define an AddressPool by providing the following mandatory fields:

* `Name`: Name of the AddressPool object.
* `Namespace`: Namespace in which this object should be created.
* `CIDR`: IP address range in CIDR notation.
* `Gateway`: Gateway IP to be associated with this AddressPool.
* `Netmask(Optional)`: Override CIDR generated Netmask for the AddressPool.

The UI will reconcile the status of the AddressPool object, and accordingly reflect the same in the UI.

#### Story 3
Admin user should be able to configure additional users, and scoping their access to specific namespaces.

This should allow Inventory to be better split up across multiple teams.

#### Story 4
Users should be able to submit a cluster by providing the following information:

* `Name`: Name of the AddressPool object.
* `Namespace`: Namespace in which this object should be created.
* `Harvester Version`: Version of harvester to install when provisioning this cluster.
* `VIP Address Pool`: AddressPool to allocate a VIP from
* `VIP Static Address (Optional)`: Static address from the AddressPool to be used as Harvester Cluster VIP.
* `SSH Keys (Optional)`: List of ssh keys to be added to the ClusterConfig, for injection into all nodes that make up the cluster.
* `Nameservers (Optional)`: List of additional nameservers to be added to the ClusterConfig.
* `ConfigURL (Optional)`: ConfigURL containing config yaml for overriding / adding common config to all nodes in the cluster.
* `NodeConfig (List)`: List of NodeConfig objects, which are a combination of the following:
  * `Inventory`: Unused inventory from list of inventory available in the rbac scoped namespace.
  * `AddressPool`: Non exhausted address pools from list of address pools available in the rbac scoped namespace.
  * `Static Address (Optional)`: A static address to be assigned to this node from the specified address pool.


Once submitted the cluster will be provisioned by Seeder and associated k8s controllers and made available for end user.

### User Experience In Detail
1) User with Admin privilege can define AddressPools
2) User with Admin privilege can define Inventory
3) User with Admin privilege can define additional users with restricted permissions
4) User with restrictive permissions can create Clusters using inventory and addresspools available

### API changes
No API changes needed as Seeder UI is a standalone project.

## Design

### Implementation Overview

Seeder backend is available [here](https://github.com/harvester/seeder).

### Test plan

Integration test plan.

### Upgrade strategy

Anything that requires if user want to upgrade to this enhancement

## Note [optional]

Additional nodes.
